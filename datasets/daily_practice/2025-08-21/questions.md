## Scenario 1: Subscription Impact on Order Frequency

**Objective:** The marketing team wants to know if the subscription program is successful at increasing how often users order. Your task is to compare the ordering behavior of users before and after they subscribe for the first time.

**Task:** For each user who has subscribed, calculate their `avg_days_between_orders_before_sub` and their `avg_days_between_orders_after_sub`. The "before" period is all time leading up to their very first subscription start date. The "after" period begins on their first subscription start date.

The final report should only include users who have at least two orders in both the "before" and "after" periods to allow for a meaningful comparison.

**Expected Output:**

| **user_id** | **avg_days_between_orders_before_sub** | **avg_days_between_orders_after_sub** |
| ----------------- | -------------------------------------------- | ------------------------------------------- |
| 101               | 19.08                                        | 12.54                                       |
| 104               | 24.04                                        | 13.00                                       |

**Your Solution:**

```sql
-- Write your solution here
```

## Scenario 2: Churn Analysis - Pre-Cancellation Behavior

**Objective:** To better predict churn, the product team wants to understand user behavior in the 30 days immediately preceding a subscription cancellation.

**Task:** For every subscription that has been cancelled (i.e., has an `end_date`), analyze the user's order activity in the 30-day window before the `end_date`. The report must show the `user_id`, the `subscription_id` that was cancelled, the `total_orders_in_last_30_days`, and the `avg_order_value_in_last_30_days`.

**Expected Output:**

| **user_id** | **subscription_id** | **total_orders_in_last_30_days** | **avg_order_value_in_last_30_days** |
| ----------------- | ------------------------- | -------------------------------------- | ----------------------------------------- |
| 102               | 2                         | 1                                      | 38.00                                     |
| 104               | 4                         | 0                                      | NULL                                      |

**Your Solution:**

```sql
-- Write your solution here
```

## Scenario 3: Calculating Customer Lifetime Value (CLV) by Subscription Cohort

**Objective:** The finance team needs to understand the total value generated by users based on when they first subscribed. This helps in evaluating the long-term effectiveness of marketing campaigns.

**Task:** Group users into monthly cohorts based on their *first ever* `start_date`. For each cohort, calculate the `total_users` in the cohort and the `avg_clv`. The Customer Lifetime Value (CLV) for a single user is defined as the sum of `order_value` for all orders they placed *after* their first subscription began.

The report should show the `cohort_month` (formatted as 'YYYY-MM'), the `total_users`, and the `avg_clv` for that cohort, rounded to two decimal places.

**Expected Output:**

| **cohort_month** | **total_users** | **avg_clv** |
| ---------------------- | --------------------- | ----------------- |
| 2023-03                | 2                     | 112.50            |
| 2023-04                | 1                     | 120.00            |
| 2023-05                | 1                     | 125.00            |

**Your Solution:**

```sql
-- Write your solution here
```
